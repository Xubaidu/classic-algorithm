---
marp: true
theme: gaia
paginate: true
backgroundColor: #fff
backgroundImage: url('https://marp.app/assets/hero-background.jpg')
style: |
  section a {
      font-size: 30px;
  }
---

# 数学 07

- 高斯消元
- 拉格朗日插值
- 题目选讲

---

## 高斯消元

给定 $n$ 元一次线性方程组

$$
\left\{\begin{matrix}
a_{1,1}x_{1} + a_{1,2}x_{2} + .. + a_{1,n}x_{n} = b_{1}\\
a_{2,1}x_{1} + a_{2,2}x_{2} + .. + a_{2,n}x_{n} = b_{2}\\
\vdots\\
a_{n,1}x_{1} + a_{n,2}x_{2} + .. + a_{n,n}x_{n} = b_{n}\\
\end{matrix}\right.
$$

高斯消元可以在 $O(n^3)$ 时间复杂度内计算各个未知数的解，计算机会用浮点数存储答案

---

## 线性代数知识回顾

在上述方程组中，未知数其实意义不大，我们主要关注系数，因此我们可以把上述的方程写成 **系数矩阵** 的形式

$$
\begin{bmatrix}
a_{1, 1} & a_{1, 2} & ... & a_{1,n}\\
a_{2, 1} & a_{2, 2} & ... & a_{2, n}\\
\vdots & \vdots & \vdots & \vdots\\
a_{n, 1} & a_{n, 2} & ... & a_{n, n}
\end{bmatrix}
$$

---

如果把 $b_{1},\ b_{2},\ ...,\ b_{n}$ 也添加上，便构成如下 **增广矩阵**

$$
\left[ \begin{array}{cccc|c}
a_{1, 1} & a_{1, 2} & ... & a_{1,n} & b_{1}\\
a_{2, 1} & a_{2, 2} & ... & a_{2, n} & b_{2}\\
\vdots & \vdots & \vdots & \vdots & \vdots\\
a_{n, 1} & a_{n, 2} & ... & a_{n, n} & b_{n}
\end{array} \right]
$$

---

高斯消元最终会把系数矩阵化为 **行阶梯矩阵**，即如下的形式

$$
\left[ \begin{array}{ccccc|c}
1 & a'_{1, 2} & a'_{1, 3} & ... & a'_{1,n} & b'_{1}\\
0 & 1 & a'_{2, 3} & ... & a'_{2, n} & b'_{2}\\
0 & 0 & 1 & ... & a'_{2, n} & b'_{3}\\
\vdots & \vdots & \vdots & \vdots & \vdots & \vdots\\
0 & 0 & ... & 1 & a'_{n - 1, n} & b'_{n - 1}\\
0 & 0 & ... & 0 & 1 & b'_{n}
\end{array} \right]
$$

---

我们要介绍的高斯约旦消元更是把系数矩阵化为如下形式的 **简化行阶梯矩阵**

$$
\left[ \begin{array}{ccccc|c}
1 & 0 & 0 & ... & 0 & b'_{1}\\
0 & 1 & 0 & ... & 0 & b'_{2}\\
0 & 0 & 1 & ... & 0 & b'_{3}\\
\vdots & \vdots & \vdots & \vdots & \vdots & \vdots\\
0 & 0 & ... & 1 & 0 & b'_{n - 1}\\
0 & 0 & ... & 0 & 1 & b'_{n}
\end{array} \right]
$$

---


## 从简单的方程组入手

给定二元一次方程

$$
\left\{\begin{matrix}
x + 3y = 16\\
x - 3y = 10
\end{matrix}\right.
$$

将两个方程相减，消元 $x$ 得到

$$
6y = 6
$$

---

从而计算出

$$
y = 1
$$

将 $y = 1$ 随意带入两个方程，都可以计算出 $x = 13$

---

## 用系数矩阵表示三元一次方程组的消元过程

给定三元一次方程

$$
\left\{\begin{matrix}
x + 3y + 4z = 190\\
x +4y +7z = 114\\
9x + 3y +2z = 76\\
\end{matrix}\right.
$$

---

我们省略未知数，将其写成系数矩阵的形式，最后一列为等号右边的数值，具体如下所示

$$
\left[\begin{array}{ccc|c}
1 & 3 & 4 & 190\\
1 & 4 & 7 & 114\\
9 & 3 & 2 & 76
\end{array}\right]
$$

---

我们手动模拟一下消元的过程

$$
\begin{aligned}
\left[\begin{array}{ccc|c}
1 & 3 & 4 & 190\\
1 & 4 & 7 & 114\\
9 & 3 & 2 & 76
\end{array}\right]
& \xrightarrow[r_{3} - 9r_{1}]{r_{2} - r_{1}}
\left[\begin{array}{ccc|c}
1 & 3 & 4 & 190\\
0 & 1 & 3 & -76\\
0 & -24 & -34 & -1634
\end{array}\right]\\
& \xrightarrow[r_{3} + 24r_{2}]{r_{1}-3r_{2}}
\left[\begin{array}{ccc|c}
1 & 0 & -5 & 418\\
0 & 1 & 3 & -76\\
0 & 0 & 38 & -3458
\end{array}\right]\\
& \xrightarrow[r_{2} - 3r_{3}]{r_{3}\times \frac{1}{38},r_{1}+5r_{3}}
\left[\begin{array}{ccc|c}
1 & 0 & 0 & -37\\
0 & 1 & 0 & 197\\
0 & 0 & 1 & -91
\end{array}\right]
\end{aligned}
$$

---

从而计算出

$$
x = -37,\ y = 197,\ z = -91
$$

---

## 消元法的一些优化

- 列主元，选取列中最大的元素所在行与当前行交换，这样最大程度保证精度

- 高斯约旦消元，将行阶梯矩阵继续化简为对角矩阵，这样可以直接计算出每一个未知数的结果

---

## 高斯约旦消元算法

算法的步骤如下

- 枚举第 $j$ 列
  - 从第 $j + 1$ 行到第 $n$ 行，寻找 **绝对值最大** 的元素作为列主元，设其所在行为 $r$，与第 $j$ 行交换
  - 从第 $1$ 行到第 $n$ 行，把除去第 $j$ 行的每一行的第 $j$ 个元素消去，其他元素相应改变

---
  
注意，在寻找列主元的过程中，如果绝对值最大的元素都为 $0$ 时，则方程组无解

在计算机中，我们可以用 $\epsilon$ 来逼近 $0$

---

## 高斯消元的应用

- 逆矩阵
- 矩阵树定理
- 期望 $dp$（本状态由前后状态转移而来）

---

## 插值

给定 $n$ 个点 $(x_{0}, y_{0}),\ (x_{1},\ y_{1}),\ (x_{2},\ y_{2}),\ ...,\ (x_{n},\ y_{n})$

可以用一个 $n$ 次多项式 $f(x)$ 来拟合这个曲线

---

## 如何理解插值

插值，顾名思义，就是画一条曲线，穿针引线，把所有的值都插进去

从我们熟悉的低阶多项式理解

两点唯一确定一条直线

三点唯一确定一个抛物线

$n + 1$ 个点唯一确定一个 $n$ 次多项式

这样的多项式 $f(x)$ 一定 **唯一存在**，数学证明省略

---

## 优秀的插值算法

具体如何还原多项式？

---

## 高斯消元的局限性

直观的做法，设 $f(x) = a_{0} + a_{1}x + .. + a_{n}x^{n}$，将 $n + 1$ 个点代入，得到 $n + 1$ 元一次方程组，可以使用高斯消元在 $O(n^3)$ 时间范围内求解

不过这个时间复杂度有点高，我们需要寻求其他的办法

---

## 拉格朗日插值

对每一个数对 $(x_{i},\ y_{i})$ 构造插值基函数

$$
\ell_{i}(x) = \prod_{j = 0,\ j\neq i}^{n}\frac{x - x_{j}}{x_{i} - x_{j}} = \frac{x - x_{0}}{x_{i} - x_{0}}\cdot \frac{x - x_{1}}{x_{i} - x_{1}}\cdots \frac{x - x_{n}}{x_{i} - x_{n}}
$$

观察知道

$$
\ell_{i}(x) = \left\{\begin{matrix}
1 & x = x_{i} \\
0 & x\neq x_{i}
\end{matrix}\right.
$$

---

进而构造拉格朗日多项式

$$
\begin{aligned}
L(x) & = \sum_{i = 0}^{n} y_i \ell_i(x)\\
& = \sum_{i = 0}^{n} y_i \prod_{j = 0,\ j\neq i}^{n}\frac{x - x_{j}}{x_{i} - x_{j}}
\end{aligned}
$$

由于 $f(x)$ 有且仅有一个，因此 $L(x) = f(x)$

拉格朗日插值法可以在 $O(n^2)$ 时间范围内计算答案

---

## 举例理解拉格朗日插值

上述函数有点抽象，我们用例子来解释

给定二次函数 $f(x)$ 上 $3$ 个点 $(4,\ 20),\ (5,\ 16),\ (6,\ 6)$，考虑还原 $f(x)$

---

写出拉格朗日插值基函数

$$
\ell_{0}(x) = \frac{(x - 5)(x - 6)}{(4 - 5)(4 - 6)}$$

$$
\ell_{1}(x) = \frac{(x - 4)(x - 6)}{(5 - 4)(5 - 6)}
$$

$$
\ell_{2}(x) = \frac{(x - 4)(x - 5)}{(6 - 4)(6 - 5)}
$$

---

进而构造拉格朗日插值多项式

$$
\begin{aligned}
f(x) & = f(4)\cdot \ell_{0}(x) + f(5)\cdot \ell_{1}(x) + f(6)\cdot \ell_{2}(x) \\
& = 20\cdot \ell_{0}(x) + 16\cdot \ell_{1}(x) + 6\cdot \ell_{2}(x)\\
& = -3x^2 + 23x - 24
\end{aligned}
$$

我们可以发现，$f(4) = 20,\ f(5) = 16,\ f(6) = 6$

因此我们还原出了 $f(x)$

---

## 特殊点插值（选讲）

当 $x_{i}$ 连续时，可以预处理一些式子来优化计算

考虑选择 $n$ 个连续的点 $(1,\ f(1)),\ (2,\ f(2)),\ ..,\ (n,\ f(n))$ 进行插值

---

拉格朗日基函数有如下形式

$$
\begin{aligned}
\ell_{i}(x) & = \frac{(x - 1)..\left [x - (i - 1)\right]\left [x - (i + 1)\right]..(x - n)}{(i - 1)..\left[i - (i - 1)\right]\left[i - (i + 1)\right]..(i - n)}\\
& = \frac{\prod\limits_{j = 1}^{i - 1}(x - j)\prod\limits_{j = i + 1}^{n}(x - j)}{(-1)^{n - i}(i - 1)!(n - i)!}
\end{aligned}
$$

---

拉格朗日多项式为

$$
L(x) = \sum_{i = 1}^{n}f(i)\frac{\prod\limits_{j = 1}^{i - 1}(x - j)\prod\limits_{j = i + 1}^{n}(x - j)}{(-1)^{n - i}(i - 1)!(n - i)!}
$$

为了计算 $L(x_{0})\ mod\ M$，我们只需要预处理 $n$ 以内所有数的阶乘，维护 $x_{0} - i$ 的前缀积与后缀积，就可以在 $O(nlogM)$ 时间复杂度内完成计算

---

## 2614. 高斯消元

给定一个 $n$ 元一次线性方程组，对其求解

$$
\left\{\begin{matrix}
a_{1,1}x_{1} + a_{1,2}x_{2} + .. + a_{1,n}x_{n} = b_{1}\\
a_{2,1}x_{1} + a_{2,2}x_{2} + .. + a_{2,n}x_{n} = b_{2}\\
\vdots\\
a_{n,1}x_{1} + a_{n,2}x_{2} + .. + a_{n,n}x_{n} = b_{n}\\
\end{matrix}\right.
$$

输入第一行一个数，表示 $n$

下面输入 $n$ 行，每行输入 $n + 1$ 个整数，表示 $a_{i,j}$ 和 $b_{i}$

---

最终输出 $1$ 行 $n$ 个数，依次表示 $x_{1},\ x_{2},\ ..,\ x_{n}$ （保留两位小数），注意行末没有空格

规定 $1\leq n\leq 100,\ |a_{i}|\leq 10^4,\ |b_{i}|\leq 10^4$

---

## 题解

高斯消元模板题，将算法实现即可，可以用一些优化使得答案更加精确

---

## 2615. 拉格朗日插值

给定 $n$ 个点 $(x_{i},\ y_{i})$，拟合 $n - 1$ 次多项式 $f(x)$，给定 $k$，计算 $f(k)\ mod\ 998244353$

数据保证

$1\leq n\leq 10^3$

$1\leq x_{i},\ y_{i},\ k\leq 998244353$，并且 $x_{i}$ 两两不同

---

## 题解

拉格朗日模板题，将算法实现即可，注意模运算的细节，例如加减乘除求逆元，一步错步步错

---

## 2618. 等幂求和（选讲）

给定 $n,\ k$，求解 $\sum\limits_{i = 1}^{n}{i^k}\ mod\ (10^9 + 7)$

规定 $1\leq n\leq 10^9,\ 0\leq k\leq 10^6$

---

## 题解

记模数 $MOD$ 为 $M$

观察数据，我们没法用 $nlogM$ 的时间复杂度计算答案

我们知道，上述式子是一个关于 $n$ 的 $k + 1$ 多项式，我们可以用 $k + 2$ 个点来拟合出此多项式

取 $(1,\ f(1)),\ (2,\ f(2)),\ ...(i,\ f(i)),\ ...,\ (k + 2,\ f(k))$，其中 $f(i) = \sum\limits_{j = 1}^{i}j^k$

---

根据拉格朗日插值，由连续点的拉格朗日插值，构造拉格朗日多项式，得到一个 $k + 1$ 次多项式，代入 $n$，答案即为

$$
L(n)\equiv \sum_{i = 1}^{k + 2}f(i)\frac{\prod\limits_{j = 1}^{i - 1}(n - j)\prod\limits_{j = i + 1}^{k + 2}(n - j)}{(-1)^{k + 2 - i}(i - 1)!(k + 2 - i)!}\ (mod\ M)
$$

我们只需要预处理 $k + 2$ 以内的阶乘，维护 $n - j$ 的前缀积和后缀积，便可以在 $O(klogM)$ 时间得到答案